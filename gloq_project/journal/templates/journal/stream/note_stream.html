<!-- Stream Content Template - Called via HTMX -->
<div class="stream-container space-y-4" id="stream-flow">
    <!-- Stream Controls -->
    <div class="flex items-center justify-between mb-4 pb-3 border-b border-gray-200/50">
        <div class="flex items-center space-x-3">
            <div class="flex items-center space-x-2">
                <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                <span class="text-xs text-gray-500 font-medium">{{ entries_count|default:0 }} drops this week</span>
            </div>
        </div>
        <div class="flex items-center space-x-2">
            <button id="stream-view-toggle" class="text-xs px-3 py-1 bg-blue-50 hover:bg-blue-100 text-blue-600 rounded-full transition-colors duration-200 font-medium">
                Chronological
            </button>
            <button class="text-xs text-gray-400 hover:text-gray-600 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
            </button>
        </div>
    </div>


        <!-- Example Entry Drop -->
       <div id="stream-entries" class="space-y-3 max-h-96 overflow-y-auto pr-2">

    {% for entry in entries %}
    <div class="drop-entry group relative bg-white/60 hover:bg-white/80 backdrop-blur-sm rounded-2xl p-4 border border-gray-200/50 hover:border-blue-200 transition-all duration-300 hover:shadow-md animate-drop-in">

        <!-- Drop Header -->
        <div class="flex items-start justify-between mb-2">
            <div class="flex items-center space-x-2">
                <!-- Mode Indicator -->
                <div class="w-3 h-3 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-full opacity-60" 
                     title="{{ entry.mode.name|default:'Default Mode' }}"></div>
                <span class="text-xs text-gray-500 font-medium">
                    {{ entry.created_at|timesince }} ago
                </span>
            </div>

            <!-- Quick Actions -->
            <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center space-x-1">
                <button class="quick-action" title="Reflect"
                    hx-post="{% url 'journal:synthesize_entries' %}"
                    hx-vals='{"entry_id": "{{ entry.id }}"}'
                    hx-target="#refractions-content">
                    üåÄ
                </button>
                <button class="quick-action" title="Tag">üè∑</button>
                <button class="quick-action" title="Favorite">‚≠ê</button>
            </div>
        </div>

        <!-- Drop Content -->
        <div class="drop-content mb-3">
            <p class="text-sm text-gray-700 leading-relaxed line-clamp-3">
                {{ entry.content|linebreaksbr }}
            </p>
        </div>

        <!-- Drop Footer -->
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2">
                {% for tag in entry.tags.all %}
                <span class="tag-chip">{{ tag.name }}</span>
                {% empty %}
                <span class="text-xs text-gray-400">no tags</span>
                {% endfor %}
            </div>
            {% if entry.has_ai_refractions %}
            <div class="refraction-marker opacity-60" title="Generated insights">
                <svg class="w-3 h-3 text-indigo-400" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
            </div>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class="text-center text-gray-400 py-6">
        No notes yet. Drop your first thought above!
    </div>
    {% endfor %}

</div>


        <!-- Another Entry Drop -->
        <div class="drop-entry group relative bg-white/60 hover:bg-white/80 backdrop-blur-sm rounded-2xl p-4 border border-gray-200/50 hover:border-green-200 transition-all duration-300 hover:shadow-md animate-drop-in" style="animation-delay: 0.1s;">

            <div class="flex items-start justify-between mb-2">
                <div class="flex items-center space-x-2">
                    <div class="w-3 h-3 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full opacity-60" title="Growth Mode"></div>
                    <span class="text-xs text-gray-500 font-medium">5 hours ago</span>
                </div>

                <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center space-x-1">
                    <button class="quick-action" title="Reflect">üåÄ</button>
                    <button class="quick-action" title="Tag">üè∑</button>
                    <button class="quick-action" title="Favorite">‚≠ê</button>
                </div>
            </div>

            <div class="drop-content mb-3">
                <p class="text-sm text-gray-700 leading-relaxed line-clamp-3">
                    Small wins today. Noticed how consistent tiny actions compound over time. The garden metaphor keeps returning to me...
                </p>
            </div>

            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <span class="tag-chip">growth</span>
                    <span class="tag-chip">consistency</span>
                </div>
            </div>
        </div>

        <!-- Ambient Drifting Quote (Older Note Resurfacing) -->
        <div class="ambient-drift opacity-40 hover:opacity-70 transition-opacity duration-500 p-3 rounded-xl border border-dashed border-gray-300 bg-gradient-to-r from-blue-50/30 to-indigo-50/30">
            <div class="flex items-start space-x-2">
                <div class="w-2 h-2 bg-blue-300 rounded-full mt-2 animate-pulse"></div>
                <div>
                    <p class="text-xs text-gray-600 italic">
                        "The most profound discoveries happen in quiet moments..."
                    </p>
                    <span class="text-xs text-gray-400">‚Üë surfaced from 3 days ago</span>
                </div>
            </div>
        </div>

        <!-- Stream Pulse Marker -->
        <div class="stream-pulse flex items-center justify-center py-4">
            <div class="flex items-center space-x-3">
                <div class="w-2 h-2 bg-blue-400 rounded-full animate-ping"></div>
                <span class="text-xs text-gray-500 italic">You've been flowing consistently</span>
                <div class="w-2 h-2 bg-blue-400 rounded-full animate-ping" style="animation-delay: 0.5s;"></div>
            </div>
        </div>

    </div>
</div>

<style>
/* Stream-specific styles */
.quick-action {
    @apply w-6 h-6 bg-gray-100 hover:bg-blue-100 rounded-full flex items-center justify-center text-gray-500 hover:text-blue-600 transition-colors duration-200;
}

.tag-chip {
    @apply text-xs px-2 py-1 bg-blue-50 text-blue-600 rounded-full font-medium;
}

.refraction-marker {
    @apply animate-pulse;
}

.drop-entry:hover .refraction-marker {
    @apply opacity-100;
}

/* Drop animation */
@keyframes drop-in {
    0% {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
    50% {
        transform: translateY(5px) scale(1.02);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.animate-drop-in {
    animation: drop-in 0.6s ease-out forwards;
}

/* Ambient drift effect */
.ambient-drift {
    position: relative;
    overflow: hidden;
}

.ambient-drift::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
    animation: drift 4s ease-in-out infinite;
}

@keyframes drift {
    0%, 100% { left: -100%; }
    50% { left: 100%; }
}

/* Stream pulse */
.stream-pulse {
    position: relative;
}

/* Scrollbar styling */
#stream-entries::-webkit-scrollbar {
    width: 4px;
}

#stream-entries::-webkit-scrollbar-track {
    background: transparent;
}

#stream-entries::-webkit-scrollbar-thumb {
    background: rgba(59, 130, 246, 0.3);
    border-radius: 2px;
}

#stream-entries::-webkit-scrollbar-thumb:hover {
    background: rgba(59, 130, 246, 0.5);
}

/* Line clamp utility */
.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>

<script>
// Stream interactivity
document.addEventListener('DOMContentLoaded', function() {

    // View toggle functionality
    const viewToggle = document.getElementById('stream-view-toggle');
    let isChronological = true;

    if (viewToggle) {
        viewToggle.addEventListener('click', function() {
            isChronological = !isChronological;
            this.textContent = isChronological ? 'Chronological' : 'Clustered';

            // Toggle view logic here
            const entries = document.querySelectorAll('.drop-entry');
            if (!isChronological) {
                // Simulate clustering by reordering entries
                // In real implementation, this would call HTMX for clustered view
                entries.forEach(entry => {
                    entry.style.order = Math.floor(Math.random() * 100);
                });
            } else {
                entries.forEach(entry => {
                    entry.style.order = 'initial';
                });
            }
        });
    }

    // Ripple effect for new drops
    function addRippleEffect(element) {
        const ripple = document.createElement('div');
        ripple.className = 'absolute inset-0 bg-blue-400/20 rounded-2xl animate-ping pointer-events-none';
        element.style.position = 'relative';
        element.appendChild(ripple);

        setTimeout(() => {
            ripple.remove();
        }, 600);
    }

    // Quick action handlers
    document.addEventListener('click', function(e) {
        if (e.target.closest('.quick-action[title="Reflect"]')) {
            // Trigger refraction generation
            const dropEntry = e.target.closest('.drop-entry');
            addRippleEffect(dropEntry);
            // HTMX will handle the actual reflection
        }

        if (e.target.closest('.quick-action[title="Favorite"]')) {
            const star = e.target.closest('.quick-action');
            star.classList.toggle('text-yellow-500');
            star.innerHTML = star.classList.contains('text-yellow-500') ? '‚≠ê' :
                `<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                </svg>`;
        }
    });

    // Simulate live updates (for demo)
    setInterval(function() {
        const streamEntries = document.getElementById('stream-entries');
        if (streamEntries && Math.random() > 0.95) { // 5% chance every interval
            // Add subtle pulse to show activity
            streamEntries.style.boxShadow = 'inset 0 0 10px rgba(59, 130, 246, 0.1)';
            setTimeout(() => {
                streamEntries.style.boxShadow = '';
            }, 1000);
        }
    }, 2000);
});
</script>