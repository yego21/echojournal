{% if active_mode.slug %}


<!-- Enhanced Mode Features -->
<div id="mode-features" class="space-y-4">

    {% if active_mode.slug != "mystical" %}
        <!-- Question/Inquiry Card -->         
        <div class="{{ feature_styles.question_container }}" onclick="toggleCard(this)">
            <div class="flex items-start space-x-4">
                <div class="flex-shrink-0">
                    <div class="{{ feature_styles.icon_container }}">
                        <svg class="{{ feature_styles.icon_class }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            {{ card_icons.mystical|safe }}
                            <!-- <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/> -->
                        </svg>
                    </div>
                </div>
                <div class="flex-1 min-w-0">
                    <h4 class="{{ feature_styles.title }}">{{ feature_content.title }}</h4>
                    <p class="{{ feature_styles.text }}">{{ feature_content.question_content }}</p>
                    
                    <div class="card-content-expanded">
                        <div class="{{ feature_styles.expanded_content }}">
                            <p class="{{ feature_styles.expanded_text }} mb-3">Reflection prompts:</p>
                            <ul class="{{ feature_styles.expanded_text }} space-y-1">
                                <li>‚Ä¢ What connections am I making between different ideas?</li>
                                <li>‚Ä¢ Where do I feel resistance or excitement?</li>
                                <li>‚Ä¢ What questions keep emerging?</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between mt-4">
                        <span class="text-xs text-gray-500">Click to expand</span>
                        <button class="{{ feature_styles.action_btn }}">
                            üí≠ Reflect on this
                        </button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    {% if active_mode.slug == "mystical" %}
        <!-- Mystical Astronomical Card -->
        <div class="{{ feature_styles.astronomical_container }}" onclick="toggleCard(this)">
            <div class="flex items-start space-x-4">
                <div class="flex-shrink-0">
                    <div class="{{ feature_styles.icon_container }}">
                        <svg class="{{ feature_styles.icon_class }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                        </svg>
                    </div>
                </div>
                <div class="flex-1 min-w-0">
                    <h4 class="{{ feature_styles.title }}">üåå Astronomical Notable</h4>
                    <p class="{{ feature_styles.text }}">{{ feature_content.astronomical }}</p>
                    
                    <div class="card-content-expanded">
                        <div class="{{ feature_styles.expanded_content }}">
                            <p class="{{ feature_styles.expanded_text }} mb-3">Cosmic connections:</p>
                            <ul class="{{ feature_styles.expanded_text }} space-y-1">
                                <li>‚Ä¢ How does this celestial event reflect in your inner world?</li>
                                <li>‚Ä¢ What cycles are you experiencing right now?</li>
                                <li>‚Ä¢ How can you align with this cosmic energy?</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between mt-4">
                        <span class="text-xs text-gray-500">Click to expand</span>
                        <button class="{{ feature_styles.action_btn }}">
                            üåü Contemplate
                        </button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Action Card -->
    <div class="{{ feature_styles.action_container }}" onclick="toggleCard(this)">
        <div class="flex items-start space-x-4">
            <div class="flex-shrink-0">
                <div class="{{ feature_styles.icon_container }}">
                    <svg class="{{ feature_styles.icon_class }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                </div>
            </div>
            <div class="flex-1 min-w-0">
                <h4 class="{{ feature_styles.title }}">
                    {% if active_mode.slug == "mystical" %}üîÆ Suggested Action
                    {% else %}‚ö° Suggested Action{% endif %}
                </h4>
                <p class="{{ feature_styles.text }}">{{ feature_content.action }}</p>
                
                <div class="card-content-expanded">
                    <div class="{{ feature_styles.expanded_content }}">
                        <p class="{{ feature_styles.expanded_text }} mb-3">Action steps:</p>
                        <ol class="{{ feature_styles.expanded_text }} space-y-2">
                            <li>1. Set aside dedicated time</li>
                            <li>2. Gather necessary materials</li>
                            <li>3. Create a focused environment</li>
                            <li>4. Document your process</li>
                        </ol>
                    </div>
                </div>
                
                <div class="flex items-center justify-between mt-4">
                    <span class="text-xs text-gray-500">Click to expand</span>
                    <button class="{{ feature_styles.action_btn }}">
                        ‚úÖ Mark as done
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Fact/Insight Card -->
    <div class="{{ feature_styles.fact_container }}" onclick="toggleCard(this)">
        <div class="flex items-start space-x-4">
            <div class="flex-shrink-0">
                <div class="{{ feature_styles.icon_container }}">
                    <svg class="{{ feature_styles.icon_class }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                </div>
            </div>
            <div class="flex-1 min-w-0">
                <h4 class="{{ feature_styles.title }}">
                    {% if active_mode.slug == "mystical" %}üìú Mystical Fact of the Day
                    {% else %}üí° Daily Insight{% endif %}
                </h4>
                <p class="{{ feature_styles.text }}">
                    {% if active_mode.slug == "mystical" %}
                        {{ feature_content.fact }}
                    {% else %}
                        {{ feature_content.fact_content }}
                    {% endif %}
                </p>
                
                <div class="card-content-expanded">
                    <div class="{{ feature_styles.expanded_content }}">
                        <p class="{{ feature_styles.expanded_text }} mb-3">
                            {% if active_mode.slug == "mystical" %}Ancient wisdom:
                            {% else %}Consider this:{% endif %}
                        </p>
                        <ul class="{{ feature_styles.expanded_text }} space-y-1">
                            <li>‚Ä¢ How does this knowledge apply to your current situation?</li>
                            <li>‚Ä¢ What patterns do you notice?</li>
                            <li>‚Ä¢ How can you integrate this insight?</li>
                        </ul>
                    </div>
                </div>
                
                <div class="flex items-center justify-between mt-4">
                    <span class="text-xs text-gray-500">Click to expand</span>
                    <button class="{{ feature_styles.action_btn }}">
                        {% if active_mode.slug == "mystical" %}üîÆ Integrate
                        {% else %}‚ú® Apply insight{% endif %}
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

{% else %}
<div class="space-y-4">
    <h4 class="font-medium text-gray-700">üìù Journal Features</h4>
    <div class="bg-gray-50 rounded-lg p-4">
        <p class="text-sm text-gray-600">
            Select a mode above to see specialized features and insights.
        </p>
    </div>
</div>
{% endif %}

<!-- JavaScript for Card Expansion -->
<script>
function toggleCard(cardElement) {
    const clickHint = cardElement.querySelector('.text-xs.text-gray-500');
    cardElement.classList.toggle('expanded');
    
    if (cardElement.classList.contains('expanded')) {
        clickHint.textContent = 'Click to collapse';
    } else {
        clickHint.textContent = 'Click to expand';
    }
}

// Ensure all cards start collapsed
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.expandable-card');
    cards.forEach(card => card.classList.remove('expanded'));
});
</script>

<!-- CSS for Enhanced Cards -->
<style>
/* Card animations and states */
.expandable-card {
    transition: all 0.3s ease;
}

.expandable-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}

/* .expandable-card.expanded {
    transform: translateY(0);
} */

.expandable-card.expanded .card-content-expanded {
    max-height: 500px;   /* or a big enough value */
    opacity: 1;
}

/* Card content transitions */
.card-content-expanded {
    transition: max-height 0.3s ease, opacity 0.3s ease;
    overflow: hidden;
    max-height: 0;   /* collapsed by default */
    opacity: 0;
}

/* Icon animations */
.icon-float {
    animation: iconFloat 3s ease-in-out infinite;
}

.icon-pulse {
    animation: iconPulse 2s ease-in-out infinite;
}

@keyframes iconFloat {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-3px); }
}

@keyframes iconPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* Action button hover effects */
.action-btn {
    transition: all 0.2s ease;
}

.action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Content type indicators */
.content-inquiry {
    border-left: 4px solid transparent;
}

.content-action {
    position: relative;
}

.content-action::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: linear-gradient(to bottom, currentColor, transparent);
    opacity: 0.6;
}

.content-insight {
    position: relative;
    overflow: hidden;
}

.content-insight::after {
    content: '';
    position: absolute;
    top: -2px;
    right: -2px;
    width: 20px;
    height: 20px;
    background: linear-gradient(45deg, transparent 30%, currentColor 30%, currentColor 70%, transparent 70%);
    opacity: 0.1;
}

/* Responsive adjustments */
@media (max-width: 640px) {
    .expandable-card {
        padding: 1rem;
    }
    
    .expandable-card .flex {
        flex-direction: column;
        space-y: 0.75rem;
    }
    
    .expandable-card .flex-shrink-0 {
        flex-shrink: 1;
        align-self: flex-start;
    }
}
</style>